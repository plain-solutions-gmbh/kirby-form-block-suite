(function(){"use strict";function s(e,t,n,i,a,r,T,j){var o=typeof e=="function"?e.options:e;return t&&(o.render=t,o.staticRenderFns=n,o._compiled=!0),{exports:e,options:o}}const l={data(){return{migrate:!1,loading:!0,status:{type:Object,default:{count:"-",read:"-",fail:"-",state:"wait"}}}},destroyed(){window.panel.events.off("form.update",this.updateCount)},created(){window.panel.events.on("content/STATUS",function(e){e.type=="content/STATUS"&&window.panel.events.emit("form.update")}),this.content.formid=this.id,this.updateCount(),window.panel.events.on("form.update",this.updateCount)},methods:{updateCount(){const e=this;this.$api.get("formblock",{action:"info",form_id:this.id,params:JSON.stringify({form_name:this.content.name})}).then(t=>{e.status=t,this.loading=!1})},onInput(e){this.$emit("update",e)}}};var d=function(){var t=this,n=t._self._c;return n("div",[n("k-grid",{staticStyle:{gap:"0.25rem","--columns":"12"}},[n("k-input",t._b({staticStyle:{"--width":"1/3"},attrs:{type:"text"},on:{input:t.onInput},model:{value:t.content.name,callback:function(i){t.$set(t.content,"name",i)},expression:"content.name"}},"k-input",t.field("name"),!1)),t.loading?n("k-box",{staticStyle:{"--width":"2/3"},attrs:{theme:"info",icon:"loader",text:t.$t("form.block.inbox.loading")}}):n("k-box",{staticStyle:{"--width":"2/3"},attrs:{icon:"email",theme:t.status.theme,text:t.$t("form.block.inbox.show")+" ("+t.status.text+")"},nativeOn:{click:function(i){return t.open.apply(null,arguments)}}})],1)],1)},c=[],u=s(l,d,c);const f=u.exports,h={extends:"k-dialog",props:{current:{type:Object,default(){}}}};var m=function(){var t=this,n=t._self._c;return n("k-dialog",t._b({ref:"dialog",staticClass:"k-field-type-page-dialog",on:{cancel:function(i){return t.$emit("cancel")},submit:function(i){return t.$emit("submit")}}},"k-dialog",t.$props,!1),[n("k-headline",[t._v(t._s(t.current.title))]),t.current.formfields?n("div",[n("table",{staticClass:"k-field-type-page-dialog-table"},t._l(t.current.formfields,function(i,a){return n("tr",{key:a,class:"field_"+a},[n("td",[t._v(t._s(i))]),t.current.attachment[a]?n("td",[n("ul",{staticClass:"k-field-type-page-dialog-linklist"},t._l(t.current.attachment[a],function(r){return n("li",{key:r.tmp_name},[n("a",{staticClass:"k-field-type-page-dialog-link",attrs:{href:r.location,download:r.name}},[n("k-icon",{attrs:{type:"attachment"}}),t._v(" "+t._s(r.name)+" ")],1)])}),0)]):n("td",[t._v(" "+t._s(t.current.formdata[a])+" ")])])}),0)]):n("div",{staticClass:"k-field-type-page-dialog-table"},[t._v(" "+t._s(t.current.formdata.summary)+" ")]),t.current.error?n("k-box",{attrs:{text:t.current.error,theme:"negative"}}):t._e()],1)},p=[],_=s(h,m,p);const g=_.exports,v={props:{value:{type:Array,required:!0},showuuid:Boolean,hideheader:Boolean},data(){return{isOpen:!1}},computed:{items(){return this.value.content.length===0?[{text:this.$t("form.block.inbox.empty"),theme:"disabled"}]:this.value.content},headerText(){return this.showuuid?this.value.header.name+" ("+this.value.uuid+")":this.value.header.name}},created(){this.isOpen=sessionStorage.getItem(`plain.form.showOpen.${this.value.page}.${this.value.uuid}`)==="on"},methods:{toggleOpen(){this.isOpen=!this.isOpen,sessionStorage.setItem(`plain.form.showOpen.${this.value.page}.${this.value.uuid}`,this.isOpen?"on":"off")}}};var k=function(){var t=this,n=t._self._c;return n("div",{staticClass:"k-mailview-list"},[t.hideheader?n("k-button",{staticClass:"k-mailview-export",attrs:{icon:"download",link:t.value.header.download,text:this.$t("form.block.inbox.export"),download:!0}}):n("div",{staticClass:"k-mailview-list-header"},[n("k-box",{attrs:{theme:t.value.header.state.theme,icon:t.isOpen?"angle-up":"angle-down",text:t.headerText},nativeOn:{click:function(i){return t.toggleOpen()}}}),n("k-button",{attrs:{icon:"download",variant:"filled",link:t.value.header.download,theme:t.value.header.state.theme,download:!0}})],1),t.isOpen||t.hideheader?n("k-items",{attrs:{items:t.items}}):t._e()],1)},y=[],w=s(v,k,y);const b=w.exports,$={props:{value:{type:String,default:""},dateformat:{type:String,default:"DD.MM.YYYY HH:mm"},forms:{type:Array,default:()=>[]},formData:{type:Object,default:()=>{}}},data(){return{data:[],filter:[],loading:!0,hideheader:!1}},computed:{thispage(){return this.$attrs.endpoints.model.replace("/pages/","").replace(/\+/g,"/")}},created(){this.formData.formid?(this.filter=[this.formData.formid],this.hideheader=!0):this.filter=this.forms,this.updateList(),window.panel.events.on("form.update",this.updateList)},destroyed(){window.panel.events.off("form.update",this.updateList)},methods:{send(e,t,n){this.$api.get("formblock",{action:e,page_id:this.thispage,request_id:(t==null?void 0:t.request)??"",form_id:(t==null?void 0:t.form)??"",params:JSON.stringify(t)}).then(i=>{this.loading=!1,n(i)})},isUnique(e){return this.data.filter(t=>e.header.page===t.header.page&&e.header.name===t.header.name).length>1},updateList(){let e=this;this.send("requestsArray",{filter:this.filter},t=>{this.data=Object.keys(t).map(function(n){return t[n].content=t[n].content.map(i=>{i.formid=n,i.attachment="attachment"in i?JSON.parse(i.attachment):!1,i.formdata=JSON.parse(i.formdata),i.formfields="formfields"in i?JSON.parse(i.formfields):!1;let a=e.$library.dayjs(i.received,"YYYY-MM-DD HH:mm:ss");return i.info=a.isValid()?a.format(e.dateformat):"",i.text=e.getLabel(i),i.image=e.getImage(i),i.buttons=[e.getButton("info",i)],i.options=[i.read===""?e.getButton("unread",i):e.getButton("read",i),e.getButton("delete",i)],i}),t[n]})})},setRead(e,t){this.send("update",{form:t.formid,request:t.slug,read:e==!1?"":this.$library.dayjs().format("YYYY-MM-DD HH:mm:ss")},()=>{window.panel.events.emit("form.update"),this.$panel.dialog.close()})},getLabel(e){return e.display?e.display:this.value?this.$helper.string.template(this.value,e.formdata):e.id},getButton(e,t){return e==="delete"?{icon:"trash",text:this.$t("form.block.inbox.delete"),click:()=>this.send("delete",{form:t.formid,request:t.slug},()=>{window.panel.events.emit("form.update")})}:e==="unread"?{icon:"preview",text:this.$t("form.block.inbox.asread"),click:()=>this.setRead(!0,t)}:e==="read"?{icon:"hidden",text:this.$t("form.block.inbox.asunread"),click:()=>this.setRead(!1,t)}:{icon:"info",click:()=>this.$panel.dialog.open({component:"k-mail-dialog",props:{current:t,size:"medium",submitButton:t.read?{}:this.getButton("unread",t),cancelButton:t.read?this.getButton("read",t):{}}})}},getImage(e){return e.read?{icon:"circle",color:"yellow",back:"transparent"}:e.error?{icon:"cancel",color:"red",back:"transparent"}:{icon:"circle-filled",color:"green",back:"transparent"}}}};var x=function(){var t=this,n=t._self._c;return n("div",{staticClass:"k-field-type-mail-view"},[t.loading?n("k-box",{attrs:{theme:"info",icon:"loader",text:t.$t("form.block.inbox.loading")}}):n("k-grid",{style:{gap:"var(--spacing-2)"},attrs:{variant:"fields"}},[t._l(t.data,function(i){return n("k-mail-list",{key:i.slug,staticClass:"k-table k-field-type-mail-table",staticStyle:{"--width":"1/1"},attrs:{hideheader:t.hideheader,value:i,showuuid:t.isUnique(i)},on:{setRead:t.setRead,deleteMail:t.deleteMail}})}),t.data.length===0?n("k-box",{staticStyle:{"--width":"1/1"},attrs:{theme:"info",text:t.$t("form.block.inbox.empty")}}):t._e()],2),n("k-plain-license",{attrs:{prefix:"formblock"}})],1)},S=[],O=s($,x,S);const C=O.exports,D={props:{prefix:{type:String,default(){return null}},styling:{type:Object,default(){return{}}}},data(){return{license:null}},computed:{licenseText(){return this.license?`<strong>${this.license.title}</strong><br />${this.license.cta}`:""},containerStyle(){return this.styling&&this.styling.container?this.styling.container:this.styling},textStyle(){var e;return((e=this.styling)==null?void 0:e.text)??{}},iconStyle(){var e;return((e=this.styling)==null?void 0:e.icon)??{}}},created(){this.license=window.panel.translation.data&&window.panel.translation.data["plain.licenses."+this.prefix]?window.panel.translation.data["plain.licenses."+this.prefix]:null,window.panel.translation.data["plain.licenses."+this.prefix]=null},methods:{showDialog(){this.license&&this.license.dialog&&this.$dialog(this.license.dialog)}}};var M=function(){var t=this,n=t._self._c;return t.license!==null?n("div",{staticClass:"k-plain-license",style:t.containerStyle,on:{click:t.showDialog}},[n("k-text",{style:t.textStyle,attrs:{size:"tiny",html:t.licenseText}}),n("k-icon",{style:t.iconStyle,attrs:{type:"alert"}})],1):t._e()},Y=[],B=s(D,M,Y);const R=B.exports;window.panel.plugin("plain/formblock",{fields:{mailview:C},components:{"k-mail-list":b,"k-mail-dialog":g,"k-plain-license":R},blocks:{form:f}})})();
