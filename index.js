(function(){"use strict";var g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("k-grid",{staticStyle:{gap:"0.25rem","--columns":"12"}},[n("k-input",t._b({staticStyle:{"--width":"1/3"},attrs:{type:"text"},on:{input:t.onInput},model:{value:t.content.name,callback:function(i){t.$set(t.content,"name",i)},expression:"content.name"}},"k-input",t.field("name"),!1)),t.loading?n("k-box",{staticStyle:{"--width":"2/3"},attrs:{theme:"info",icon:"loader",text:t.$t("form.block.inbox.loading")}}):n("k-box",{staticStyle:{"--width":"2/3"},attrs:{icon:"email",theme:t.status.theme,text:t.$t("form.block.inbox.show")+" ("+t.status.text+")"},nativeOn:{click:function(i){return t.open.apply(null,arguments)}}})],1)],1)},$=[];function d(t,e,n,i,a,r,_,W){var s=typeof t=="function"?t.options:t;e&&(s.render=e,s.staticRenderFns=n,s._compiled=!0),i&&(s.functional=!0),r&&(s._scopeId="data-v-"+r);var o;if(_?(o=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(l=__VUE_SSR_CONTEXT__),a&&a.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(_)},s._ssrRegister=o):a&&(o=W?function(){a.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:a),o)if(s.functional){s._injectStyles=o;var G=s.render;s.render=function(K,v){return o.call(v),G(K,v)}}else{var m=s.beforeCreate;s.beforeCreate=m?[].concat(m,o):[o]}return{exports:t,options:s}}const y={data(){return{migrate:!1,loading:!0,status:{type:Object,default:{count:"-",read:"-",fail:"-",state:"wait"}}}},destroyed(){window.panel.events.off("form.update",this.updateCount)},created(){window.panel.events.on("content/STATUS",function(t){t.type=="content/STATUS"&&window.panel.events.emit("form.update")}),this.content.formid=this.id,this.updateCount(),window.panel.events.on("form.update",this.updateCount)},methods:{updateCount(){const t=this;this.$api.get("formblock",{action:"info",form_id:this.id,params:JSON.stringify({form_name:this.content.name})}).then(e=>{t.status=e,this.loading=!1})},onInput(t){this.$emit("update",t)}}},u={};var k=d(y,g,$,!1,b,null,null,null);function b(t){for(let e in u)this[e]=u[e]}var w=function(){return k.exports}(),x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("k-dialog",t._b({ref:"dialog",staticClass:"k-field-type-page-dialog",on:{cancel:function(i){return t.$emit("cancel")},submit:function(i){return t.$emit("submit")}}},"k-dialog",t.$props,!1),[n("k-headline",[t._v(t._s(t.current.title))]),t.current.formfields?n("div",[n("table",{staticClass:"k-field-type-page-dialog-table"},t._l(t.current.formfields,function(i,a){return n("tr",{key:a,class:"field_"+a},[n("td",[t._v(t._s(i))]),t.current.attachment[a]?n("td",[n("ul",{staticClass:"k-field-type-page-dialog-linklist"},t._l(t.current.attachment[a],function(r){return n("li",{key:r.tmp_name},[n("a",{staticClass:"k-field-type-page-dialog-link",attrs:{href:r.location,download:r.name}},[n("k-icon",{attrs:{type:"attachment"}}),t._v(" "+t._s(r.name)+" ")],1)])}),0)]):n("td",[t._v(" "+t._s(t.current.formdata[a])+" ")])])}),0)]):n("div",{staticClass:"k-field-type-page-dialog-table"},[t._v(" "+t._s(t.current.formdata.summary)+" ")]),t.current.error?n("k-box",{attrs:{text:t.current.error,theme:"negative"}}):t._e()],1)},S=[],Q="";const O={extends:"k-dialog",props:{current:{type:Object,default(){}}}},c={};var C=d(O,x,S,!1,M,null,null,null);function M(t){for(let e in c)this[e]=c[e]}var R=function(){return C.exports}(),D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-mailview-list"},[t.hideheader?t._e():n("div",{staticClass:"k-mailview-list-header"},[n("k-button",{attrs:{icon:"download",variant:"filled",link:t.value.header.download,theme:t.value.header.state.theme,download:!0}}),n("k-box",{attrs:{theme:t.value.header.state.theme,icon:t.isOpen?"angle-up":"angle-down",text:t.headerText},nativeOn:{click:function(i){return t.toggleOpen()}}})],1),t.isOpen||t.hideheader?n("k-items",{attrs:{items:t.items}}):t._e()],1)},T=[],Z="";const Y={props:{value:{type:Array,required:!0},showuuid:Boolean,hideheader:Boolean},data(){return{isOpen:!1}},computed:{items(){return this.value.content.length===0?[{text:this.$t("form.block.inbox.empty"),theme:"disabled"}]:this.value.content},headerText(){return this.showuuid?this.value.header.name+" ("+this.value.uuid+")":this.value.header.name}},created(){this.isOpen=sessionStorage.getItem(`plain.form.showOpen.${this.value.page}.${this.value.uuid}`)==="on"},methods:{toggleOpen(){this.isOpen=!this.isOpen,sessionStorage.setItem(`plain.form.showOpen.${this.value.page}.${this.value.uuid}`,this.isOpen?"on":"off")}}},f={};var B=d(Y,D,T,!1,j,null,null,null);function j(t){for(let e in f)this[e]=f[e]}var L=function(){return B.exports}(),F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"k-field-type-mail-view"},[t.loading?n("k-box",{attrs:{theme:"info",icon:"loader",text:t.$t("form.block.inbox.loading")}}):n("k-grid",{style:{gap:"var(--spacing-2)"},attrs:{variant:"fields"}},[t._l(t.data,function(i){return n("k-mail-list",{key:i.slug,staticClass:"k-table k-field-type-mail-table",staticStyle:{"--width":"1/1"},attrs:{hideheader:t.hideheader,value:i,showuuid:t.isUnique(i)},on:{setRead:t.setRead,deleteMail:t.deleteMail}})}),t.data.length===0?n("k-box",{staticStyle:{"--width":"1/1"},attrs:{theme:"info",text:t.$t("form.block.inbox.empty")}}):t._e()],2),n("k-plain-license",{attrs:{prefix:"formblock"}})],1)},N=[];const E={props:{value:{type:String,default:""},dateformat:{type:String,default:"DD.MM.YYYY HH:mm"},forms:{type:Array,default:()=>[]},formData:{type:Object,default:()=>{}}},data(){return{data:[],filter:[],loading:!0,hideheader:!1}},computed:{thispage(){return this.$attrs.endpoints.model.replace("/pages/","").replace(/\+/g,"/")}},created(){this.formData.formid?(this.filter=[this.formData.formid],this.hideheader=!0):this.filter=this.forms,this.updateList(),window.panel.events.on("form.update",this.updateList)},destroyed(){window.panel.events.off("form.update",this.updateList)},methods:{send(t,e,n){var i,a;this.$api.get("formblock",{action:t,page_id:this.thispage,request_id:(i=e==null?void 0:e.request)!=null?i:"",form_id:(a=e==null?void 0:e.form)!=null?a:"",params:JSON.stringify(e)}).then(r=>{this.loading=!1,n(r)})},isUnique(t){return this.data.filter(e=>t.header.page===e.header.page&&t.header.name===e.header.name).length>1},updateList(){let t=this;this.send("requestsArray",{filter:this.filter},e=>{this.data=Object.keys(e).map(function(n){return e[n].content=e[n].content.map(i=>{i.formid=n,i.attachment="attachment"in i?JSON.parse(i.attachment):!1,i.formdata=JSON.parse(i.formdata),i.formfields="formfields"in i?JSON.parse(i.formfields):!1;let a=t.$library.dayjs(i.received,"YYYY-MM-DD HH:mm:ss");return i.info=a.isValid()?a.format(t.dateformat):"",i.text=t.getLabel(i),i.image=t.getImage(i),i.buttons=[t.getButton("info",i)],i.options=[i.read===""?t.getButton("unread",i):t.getButton("read",i),t.getButton("delete",i)],i}),e[n]})})},setRead(t,e){this.send("update",{form:e.formid,request:e.slug,read:t==!1?"":this.$library.dayjs().format("YYYY-MM-DD HH:mm:ss")},()=>{window.panel.events.emit("form.update"),this.$panel.dialog.close()})},getLabel(t){return t.display?t.display:this.value?this.$helper.string.template(this.value,t.formdata):t.id},getButton(t,e){return t==="delete"?{icon:"trash",text:this.$t("form.block.inbox.delete"),click:()=>this.send("delete",{form:e.formid,request:e.slug},()=>{window.panel.events.emit("form.update")})}:t==="unread"?{icon:"preview",text:this.$t("form.block.inbox.asread"),click:()=>this.setRead(!0,e)}:t==="read"?{icon:"hidden",text:this.$t("form.block.inbox.asunread"),click:()=>this.setRead(!1,e)}:{icon:"info",click:()=>this.$panel.dialog.open({component:"k-mail-dialog",props:{current:e,size:"medium",submitButton:e.read?{}:this.getButton("unread",e),cancelButton:e.read?this.getButton("read",e):{}}})}},getImage(t){return t.read?{icon:"circle",color:"yellow",back:"transparent"}:t.error?{icon:"cancel",color:"red",back:"transparent"}:{icon:"circle-filled",color:"green",back:"transparent"}}}},h={};var H=d(E,F,N,!1,I,null,null,null);function I(t){for(let e in h)this[e]=h[e]}var U=function(){return H.exports}(),A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.license!==null?n("div",{staticClass:"k-plain-license",style:t.containerStyle,on:{click:t.showDialog}},[n("k-text",{style:t.textStyle,attrs:{size:"tiny",html:t.licenseText}}),n("k-icon",{style:t.iconStyle,attrs:{type:"alert"}})],1):t._e()},J=[],q="";const V={props:{prefix:{type:String,default(){return null}},styling:{type:Object,default(){return{}}}},data(){return{license:null}},computed:{licenseText(){return this.license?`<strong>${this.license.title}</strong><br />${this.license.cta}`:""},containerStyle(){return this.styling&&this.styling.container?this.styling.container:this.styling},textStyle(){var t,e;return(e=(t=this.styling)==null?void 0:t.text)!=null?e:{}},iconStyle(){var t,e;return(e=(t=this.styling)==null?void 0:t.icon)!=null?e:{}}},created(){this.license=window.panel.translation.data&&window.panel.translation.data["plain.licenses."+this.prefix]?window.panel.translation.data["plain.licenses."+this.prefix]:null,window.panel.translation.data["plain.licenses."+this.prefix]=null},methods:{showDialog(){this.license&&this.license.dialog&&this.$dialog(this.license.dialog)}}},p={};var z=d(V,A,J,!1,P,null,null,null);function P(t){for(let e in p)this[e]=p[e]}var X=function(){return z.exports}();window.panel.plugin("plain/formblock",{fields:{mailview:U},components:{"k-mail-list":L,"k-mail-dialog":R,"k-plain-license":X},blocks:{form:w}})})();
